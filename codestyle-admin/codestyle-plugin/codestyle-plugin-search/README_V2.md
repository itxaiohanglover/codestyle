# CodeStyle æ£€ç´¢æ¨¡å—

> åŸºäº CodeStyle é¡¹ç›®è§„èŒƒçš„ä¼ä¸šçº§å¤šæºæ··åˆæ£€ç´¢æ¨¡å—

[![Version](https://img.shields.io/badge/version-2.0-blue.svg)](SUMMARY.md)
[![Status](https://img.shields.io/badge/status-è§„åˆ’ä¸­-yellow.svg)](SUMMARY.md)
[![License](https://img.shields.io/badge/license-Apache%202.0-green.svg)](LICENSE)

---

## ğŸ“– æ¦‚è¿°

CodeStyle æ£€ç´¢æ¨¡å—æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„å¤šæºæ··åˆæ£€ç´¢è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ Elasticsearch å…¨æ–‡æ£€ç´¢ã€Milvus å‘é‡æ£€ç´¢ï¼Œå¹¶æä¾›æ™ºèƒ½é‡æ’ã€å¤šçº§ç¼“å­˜å’Œå®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ” **å¤šæºæ£€ç´¢**ï¼šæ”¯æŒ Elasticsearchã€Milvus ç­‰å¤šç§æ•°æ®æº
- ğŸ”„ **æ··åˆæ£€ç´¢**ï¼šä½¿ç”¨ RRF ç®—æ³•èåˆå…¨æ–‡æ£€ç´¢å’Œå‘é‡æ£€ç´¢ç»“æœ
- ğŸ“Š **æ™ºèƒ½é‡æ’**ï¼šé›†æˆ BGE-Rerank æ¨¡å‹æå‡ç›¸å…³æ€§
- ğŸš€ **é«˜æ€§èƒ½**ï¼šå¤šçº§ç¼“å­˜ï¼ˆCaffeine + Redisï¼‰
- ğŸ›¡ï¸ **é«˜å¯ç”¨**ï¼šå®Œå–„çš„å®¹é”™æœºåˆ¶ï¼ˆè¶…æ—¶æ§åˆ¶ã€é™çº§ç­–ç•¥ã€é‡è¯•æœºåˆ¶ï¼‰
- ğŸ“ **è§„èŒƒç»Ÿä¸€**ï¼šéµå¾ª CodeStyle é¡¹ç›®å¼€å‘è§„èŒƒ

---

## ğŸ“‚ æ–‡æ¡£å¯¼èˆª

### æ ¸å¿ƒæ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| [SUMMARY.md](SUMMARY.md) | ğŸ“‹ é¡¹ç›®æ€»ç»“å’Œå½“å‰çŠ¶æ€ | âœ… å®Œæˆ |
| [DESIGN_V2.md](DESIGN_V2.md) | ğŸ—ï¸ V2 æ¶æ„è®¾è®¡æ–‡æ¡£ | âœ… å®Œæˆ |
| [IMPLEMENTATION_V2.md](IMPLEMENTATION_V2.md) | ğŸ“ V2 å®ç°è§„åˆ’æ–‡æ¡£ | âœ… å®Œæˆ |
| [CHANGES_V1_TO_V2.md](CHANGES_V1_TO_V2.md) | ğŸ”„ V1â†’V2 å˜æ›´è¯´æ˜ | âœ… å®Œæˆ |

### å†å²æ–‡æ¡£ï¼ˆå·²åºŸå¼ƒï¼‰

| æ–‡æ¡£ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| [DESIGN.md](DESIGN.md) | V1 è®¾è®¡æ–‡æ¡£ï¼ˆSPI é£æ ¼ï¼‰ | âŒ å·²åºŸå¼ƒ |
| [IMPLEMENTATION.md](IMPLEMENTATION.md) | V1 å®ç°è§„åˆ’ | âŒ å·²åºŸå¼ƒ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Controller å±‚                         â”‚
â”‚              SearchController (REST API)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Service å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SearchService (æ£€ç´¢ç¼–æ’æœåŠ¡)                      â”‚  â”‚
â”‚  â”‚  - å•æºæ£€ç´¢                                        â”‚  â”‚
â”‚  â”‚  - æ··åˆæ£€ç´¢ (RRF èåˆ)                            â”‚  â”‚
â”‚  â”‚  - æ£€ç´¢å¹¶é‡æ’                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ES æ£€ç´¢æœåŠ¡   â”‚ Milvus æ£€ç´¢   â”‚ é‡æ’æœåŠ¡          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Helper å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç¼“å­˜åŠ©æ‰‹      â”‚ èåˆç®—æ³•åŠ©æ‰‹  â”‚ å®¹é”™åŠ©æ‰‹          â”‚   â”‚
â”‚  â”‚ CacheHelper  â”‚ FusionHelper â”‚ FallbackHelper   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚è¯´æ˜

| å±‚çº§ | èŒè´£ | ç¤ºä¾‹ |
|------|------|------|
| **Controller** | å¤„ç† HTTP è¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒ | `SearchController` |
| **Service** | ä¸šåŠ¡é€»è¾‘ç¼–æ’ï¼Œäº‹åŠ¡ç®¡ç† | `SearchService`, `ElasticsearchSearchService` |
| **Helper** | å·¥å…·ç±»ï¼Œæ— çŠ¶æ€è¾…åŠ©æ–¹æ³• | `CacheHelper`, `FusionHelper` |
| **Model** | æ•°æ®æ¨¡å‹å®šä¹‰ | `SearchRequest`, `SearchResult` |
| **Config** | é…ç½®ç±» | `SearchProperties`, `ElasticsearchConfig` |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. å¤šæºæ£€ç´¢

æ”¯æŒå¤šç§æ•°æ®æºï¼Œæ¯ç§æ•°æ®æºæœ‰ç‹¬ç«‹çš„ Service å®ç°ï¼š

```java
// Elasticsearch å…¨æ–‡æ£€ç´¢
ElasticsearchSearchService.search(request)

// Milvus å‘é‡æ£€ç´¢
MilvusSearchService.search(request)
```

### 2. æ··åˆæ£€ç´¢

ä½¿ç”¨ RRFï¼ˆReciprocal Rank Fusionï¼‰ç®—æ³•èåˆå¤šä¸ªæ•°æ®æºçš„ç»“æœï¼š

```java
// å¹¶è¡ŒæŸ¥è¯¢ ES å’Œ Milvus
List<SearchResult> results = SearchService.hybridSearch(request)

// RRF å…¬å¼: score = 1 / (k + rank)ï¼Œk = 60
```

### 3. æ™ºèƒ½é‡æ’

ä½¿ç”¨ BGE-Rerank æ¨¡å‹å¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ’åºï¼š

```java
// æ£€ç´¢å¹¶é‡æ’
List<SearchResult> results = SearchService.searchWithRerank(request)
```

### 4. å¤šçº§ç¼“å­˜

```
L1: Caffeine æœ¬åœ°ç¼“å­˜ (5åˆ†é’Ÿ)
    â†“ Miss
L2: Redis åˆ†å¸ƒå¼ç¼“å­˜ (1å°æ—¶)
    â†“ Miss
æ•°æ®æºæŸ¥è¯¢ (ES/Milvus)
```

### 5. å®¹é”™æœºåˆ¶

- â±ï¸ **è¶…æ—¶æ§åˆ¶**ï¼šå¯é…ç½®çš„æŸ¥è¯¢è¶…æ—¶æ—¶é—´
- ğŸ”„ **é‡è¯•æœºåˆ¶**ï¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
- ğŸ“‰ **é™çº§ç­–ç•¥**ï¼šæœåŠ¡å¼‚å¸¸æ—¶è¿”å›é™çº§ç»“æœ
- ğŸ”Œ **ç†”æ–­ä¿æŠ¤**ï¼šé˜²æ­¢é›ªå´©æ•ˆåº”

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®

åœ¨ `application.yml` ä¸­æ·»åŠ ï¼š

```yaml
search:
  enabled: true
  
  elasticsearch:
    enabled: true
    hosts: localhost:9200
    index: codestyle_templates
    
  milvus:
    enabled: false
    host: localhost
    port: 19530
    
  cache:
    enabled: true
    local:
      max-size: 1000
      ttl: 300
    redis:
      ttl: 3600
```

### 2. API ä½¿ç”¨

#### å•æºæ£€ç´¢

```bash
POST /api/search/single
{
  "query": "å¦‚ä½•é…ç½® MySQL è¿æ¥æ± ",
  "sourceType": "ELASTICSEARCH",
  "topK": 10
}
```

#### æ··åˆæ£€ç´¢

```bash
POST /api/search/hybrid
{
  "query": "å¦‚ä½•é…ç½® MySQL è¿æ¥æ± ",
  "topK": 10
}
```

#### æ£€ç´¢å¹¶é‡æ’

```bash
POST /api/search/rerank
{
  "query": "å¦‚ä½•é…ç½® MySQL è¿æ¥æ± ",
  "topK": 10,
  "enableRerank": true
}
```

#### å¿«é€Ÿæ£€ç´¢ï¼ˆGETï¼‰

```bash
GET /api/search/quick?query=MySQL&topK=5
```

---

## ğŸ“Š é¡¹ç›®çŠ¶æ€

### å½“å‰ç‰ˆæœ¬ï¼šV2ï¼ˆè®¾è®¡é˜¶æ®µï¼‰

```
æ€»è¿›åº¦ï¼šâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 20%

âœ… æ¶æ„è®¾è®¡     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
âœ… æ–‡æ¡£ç¼–å†™     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
â³ ä»£ç å®ç°     â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
â³ æµ‹è¯•éªŒè¯     â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
â³ éƒ¨ç½²ä¸Šçº¿     â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
```

### V1 vs V2 å¯¹æ¯”

| ç»´åº¦ | V1 | V2 |
|------|----|----|
| æ¶æ„é£æ ¼ | SPI + Provider âŒ | Service + Helper âœ… |
| å‘½åè§„èŒƒ | å¾®æœåŠ¡é£æ ¼ âŒ | CodeStyle é£æ ¼ âœ… |
| å®¹é”™æœºåˆ¶ | åŸºç¡€ âš ï¸ | å®Œå–„ âœ… |
| ç¼“å­˜ç­–ç•¥ | å•çº§ âš ï¸ | å¤šçº§ âœ… |
| ä»£ç å¤æ‚åº¦ | è¾ƒé«˜ âš ï¸ | é€‚ä¸­ âœ… |

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„ï¼ˆ3 å¤©ï¼‰

- [ ] æ¸…ç† V1 ä»£ç 
- [ ] å®ç° Service å±‚
- [ ] å®ç° Helper å±‚
- [ ] å®ç° Controller å±‚

### é˜¶æ®µäºŒï¼šMilvus é›†æˆï¼ˆ2 å¤©ï¼‰

- [ ] é…ç½® Milvus å®¢æˆ·ç«¯
- [ ] å®ç°å‘é‡æ£€ç´¢
- [ ] å®ç°æ··åˆæ£€ç´¢

### é˜¶æ®µä¸‰ï¼šé‡æ’å’Œç¼“å­˜ï¼ˆ2 å¤©ï¼‰

- [ ] å®ç°é‡æ’æœåŠ¡
- [ ] å®ç°å¤šçº§ç¼“å­˜
- [ ] å®ç°ç¼“å­˜å¤±æ•ˆ

### é˜¶æ®µå››ï¼šæµ‹è¯•å’Œæ–‡æ¡£ï¼ˆ1 å¤©ï¼‰

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ›´æ–°æ–‡æ¡£

**é¢„è®¡æ€»æ—¶é—´**ï¼š1-2 å‘¨

---

## ğŸ’¡ è®¾è®¡äº®ç‚¹

### 1. éµå¾ªé¡¹ç›®è§„èŒƒ

- âœ… ä½¿ç”¨ Service/Helper å‘½åï¼Œè€Œé Provider/Facade
- âœ… éµå¾ª CodeStyle åˆ†å±‚æ¶æ„
- âœ… ç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è§„èŒƒ

### 2. ç®€å•ç›´æ¥

- âœ… ä½¿ç”¨ Spring ä¾èµ–æ³¨å…¥ï¼Œè€Œé SPI
- âœ… é¿å…è¿‡åº¦æŠ½è±¡
- âœ… ä»£ç æ˜“è¯»æ˜“ç»´æŠ¤

### 3. ç”Ÿäº§å¯ç”¨

- âœ… å®Œå–„çš„å®¹é”™æœºåˆ¶
- âœ… å¤šçº§ç¼“å­˜ç­–ç•¥
- âœ… æ€§èƒ½ç›‘æ§æŒ‡æ ‡

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘è§„èŒƒ

1. **å‘½åè§„èŒƒ**ï¼šéµå¾ª CodeStyle é¡¹ç›®è§„èŒƒ
2. **ä»£ç æ ¼å¼**ï¼šä½¿ç”¨ Spotless è‡ªåŠ¨æ ¼å¼åŒ–
3. **æ³¨é‡Šè§„èŒƒ**ï¼šæ‰€æœ‰ç±»å’Œæ–¹æ³•å¿…é¡»æœ‰ Javadoc
4. **æµ‹è¯•è¦æ±‚**ï¼šå•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### æäº¤æµç¨‹

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ä»£ç ï¼ˆéµå¾ªè§„èŒƒï¼‰
4. åˆ›å»º Pull Request

---

## ğŸ“š å‚è€ƒèµ„æ–™

### é¡¹ç›®æ–‡æ¡£

- [CodeStyle æœ€ä½³å®è·µ](../../../CODESTYLE_BEST_PRACTICES.md)
- [CodeStyle è¿›é˜¶å®è·µ](../../../CODESTYLE_BEST_PRACTICES_ADVANCED.md)

### å¤–éƒ¨èµ„æº

- [AssistantAgent æ£€ç´¢æ¶æ„](https://java2ai.com/agents/assistantagent/features/search/advanced)
- [Elasticsearch å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html)
- [Milvus å®˜æ–¹æ–‡æ¡£](https://milvus.io/docs)
- [BGE-Rerank æ¨¡å‹](https://huggingface.co/BAAI/bge-reranker-v2-m3)

---

## ğŸ“„ è®¸å¯è¯

Apache License 2.0

---

## ğŸ‘¥ å›¢é˜Ÿ

**å¼€å‘å›¢é˜Ÿ**: CodeStyle Team  
**é¡¹ç›®è´Ÿè´£äºº**: Charles7c  
**æœ€åæ›´æ–°**: 2026-01-29

---

## ğŸ“ è”ç³»æ–¹å¼

- ğŸ“§ Email: support@codestyle.top
- ğŸŒ Website: https://codestyle.top
- ğŸ’¬ Issues: [GitHub Issues](https://github.com/Charles7c/continew-admin/issues)

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼**

